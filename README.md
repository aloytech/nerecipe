# Дипломная работа профессии "Android-разработчик"
# Книга рецептов

## Общее описание
Приложение представляет доступ к кулинарной книге (списку рецептов).
Вся информация хранится на сервере Firebase, поэтому приложение **не автономно**

Рецепты оформлены в виде названия, картинки и списка шагов приготовления.

## Структура приложения

### Основной экран
Основной экран приложения показывает список рецептов в кратком виде: название, изображение, автор.

![](./pic/main_1_start.png)

#### Фильтр

Рецепты на основном экране можно фильтровать по категориям, для этого есть кнопка в правом верхнем углу.
По нажатию открывается диалог для выбора категорий:

![](./pic/main_2_categoryFilter.png)

Выбираем нужные категории, нажимаем применить:

![](./pic/main_3_filteredByCat.png)

Сама кнопка изменит вид (фильтр не перечеркнут)

**примечание**: если снять все чекбоксы, то фильтр не применяется, выводится сообщение.

Рецепты на основном экране так же можно фильтровать по избранному, для этого используется кнопка в левом нижнем углу.
Показываются только рецепты помеченные, как избранное. Иконка кнопки изменится:

![](./pic/main_4_filteredByCatFav.png)

**примечание**: понятия избранное и лайк в приложении эквакатентны. Т.е. количество лайков, равно количесту пользователей, которые добавили рецепт в избранное.

#### Поиск

Над списком рецептов располагается строка поиска. Если начать ввод, то в списке рецептов остаются только рецепты, в названии которых присутствуют введенные символы (фильтр по вхождению строки)

![](./pic/main_5_search.png)

#### Действия с рецептом

Для каждого рецепта возможны действия:
1. Добавить\удалить из избранного по нажатию кнопки справа от рецепта.
1. По нажатию на рецепт переход к полному описанию приготовления (нажатие в области элемента списка: имя, картинку, автора)
1. По нажатию кнопки меню справа от рецепта: удалить или редактрировать

![](./pic/main_6_menu.png)

### Экран рецепта

Показывает полное описание шагов приготовления рецепта. В верхней части виджеты управления рецептом, как на основном экране (добавить в избранное, меню: удалить, редактировать)

![](./pic/recipeFull_1.png)

**примечание**: в текущей реализации установка уникальной картинки возможна только для всего рецепта. Для каждого шага приготовления используется картинка-заглушка.

### Экран редактирования рецепта

На экране редактирования возможно:
1. Изменить название рецепта - редактируемое текстовое поле
1. Изменить категорию рецепта - кнопка с выпадающим меню
1. Изменить порядок этапов приготовления посредством перетаскивания по списку
1. Удалить этап приготовления, смахнув его вправо
1. Перейти к редактированию этапа приготовления, смахнув его влево
1. Добавить новый этап по нажатию кнопки
1. Перейти к изменению картинки - нажать на картинке

![](./pic/recipeEdit_1.png)

**примечание**: оставить поле ввода имени пустым и удалить все этапы нельзя - при нажатии на "сохранить" будет выведено соответствующее сообщение.

#### Изменеие категории рецепта

При нажатии на кнопку с именем текущей категории выпадает меню с полным списком категорий

![](./pic/recipeEdit_2_category.png)

#### Редактирование этапа приготовления (создание нового)

При смахивании этапа вправо (или нажатии на кнопку добавления этапа) переход к редактированию этапа:

![](./pic/editStage.png)

**примечание**: оставить поле ввода пустым нельзя - при нажатии на "сохранить" будет выведено соответствующее сообщение.
**примечание**: в случае нажатия кнопки назад, введенный текст сохранится в черновике. Можно будет продолжить при переходе по кнопке добавления этапа.
**важно**: в текущей реализации изменения этапа происходит через удаление, т.е. этап удаляется из списка и при сохранении изменений добавляется в конец списка, как новый.

#### Изменение картинки рецепта

При нажатии на картинку переход на экран загрузки изображения.

![](./pic/uploadImage_1.png) ![](./pic/uploadImage_2.png)

Нажатие на кнопку выбора изображения происходит вызов стандартного выбора из галереи устройства.
Нажатие на кнопку загрузки изображения сохраняет картинку в базе (отправляется на сервер firebase storage) и привязывает ее к текущему рецепту.

## Техническая реализация

### Основные сущности и храниние

В приложении присутствуют три основные сущности: рецепт, пользователь (автор), категория.
Использован подход храниения сущностей в разных таблицах, связанных по ключам.
Таким образом в рецепте хранится только идентификатор автора и категории, в то время как в пользователе хранится список идентификаторов рецептов, добавленных в избранное.
Таблицы хранятся в базе данных Firestore Database

![](./pic/database.png)

#### Рецепт
Содержит информацию о рецепте: название, идентификатор автора, идентификатор категории, количество лайков, этапы приготовления.

<details>
<summary> class Recipe</summary>
```
data class Recipe(
    val id: Int,
    val authorId: Int,
    val name: String,
    val categoryId: Int,
    val likesCount: Int,
    val servingLink: String,
    val stages: ArrayList<String>,
    val stagesLink: List<String>
)
```
</details>

#### Пользователь (автор)
Содержит информацию о пользователе: имя, список идентификаторв избранных рецептов, хеш пароля.
Соответственно рецепт ссылается на пользователя как на своего автора, в то время как пользователь ссылается на рецепты из избранного.
<details>
<summary> class User</summary>
```
data class User(
    val uid: Int,
    val userName: String,
    val favorites: List<Int>? = null,
    val hash: Int
)
```
</details>
**примечание**: в текущей реализации авторизация отсутствует. Идентификатор текущего пользователя устанавливается посредством пустой функции getCurrentUser (из числа существующих пользователей)
***примечание***: при удалении рецепта происходит проверка по избранному всех пользователей и удаление. Обратная ситуация не рассматривается, т.к. удаление пользователей не предусмотрено.

#### Категория
По факту просто список названий. Т.к. в текущей реализации нет потребностей вносить в список изменения то используется локальный константный список. Но соответствующая таблица на сервере присутствует.
<details>
<summary> class Category</summary>
```
data class Category(
    val cid: Int,
    val categoryName: String
)
```
</details>

-- <cite>Alexey Potapov</cite>
[aloytech](https://github.com/aloytech)